<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>JSON/XML Formatter</title>-->
<!--    <style>-->
<!--        * {-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            box-sizing: border-box;-->
<!--        }-->

<!--        body {-->
<!--            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;-->
<!--            background: #2d2d2d;-->
<!--            color: #fff;-->
<!--            height: 100vh;-->
<!--            overflow: hidden;-->
<!--        }-->

<!--        .header {-->
<!--            background: linear-gradient(135deg, #4a4a4a 0%, #3a3a3a 100%);-->
<!--            padding: 15px 20px;-->
<!--            border-bottom: 2px solid #555;-->
<!--        }-->

<!--        .header h1 {-->
<!--            font-size: 22px;-->
<!--            font-weight: 500;-->
<!--        }-->

<!--        .controls {-->
<!--            background: #3a3a3a;-->
<!--            padding: 15px 20px;-->
<!--            display: flex;-->
<!--            gap: 10px;-->
<!--            flex-wrap: wrap;-->
<!--            border-bottom: 1px solid #555;-->
<!--        }-->

<!--        .btn {-->
<!--            background: #5a9f5a;-->
<!--            color: white;-->
<!--            border: none;-->
<!--            padding: 10px 20px;-->
<!--            border-radius: 5px;-->
<!--            cursor: pointer;-->
<!--            font-size: 14px;-->
<!--            font-weight: 500;-->
<!--            transition: all 0.3s;-->
<!--        }-->

<!--        .btn:hover {-->
<!--            background: #4a8f4a;-->
<!--            transform: translateY(-1px);-->
<!--        }-->

<!--        .btn-secondary {-->
<!--            background: #6a6a6a;-->
<!--        }-->

<!--        .btn-secondary:hover {-->
<!--            background: #7a7a7a;-->
<!--        }-->

<!--        select {-->
<!--            background: #4a4a4a;-->
<!--            color: white;-->
<!--            border: 1px solid #666;-->
<!--            padding: 10px 15px;-->
<!--            border-radius: 5px;-->
<!--            cursor: pointer;-->
<!--            font-size: 14px;-->
<!--        }-->

<!--        .container {-->
<!--            display: flex;-->
<!--            height: calc(100vh - 130px);-->
<!--            gap: 2px;-->
<!--            background: #555;-->
<!--        }-->

<!--        .panel {-->
<!--            flex: 1;-->
<!--            min-width: 0;-->
<!--            max-width: 50%;-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            background: #2d2d2d;-->
<!--        }-->

<!--        .panel-header {-->
<!--            background: #181f40;-->
<!--            padding: 12px 15px;-->
<!--            font-weight: 500;-->
<!--            font-size: 15px;-->
<!--        }-->

<!--        .editor-wrapper {-->
<!--            flex: 1;-->
<!--            display: flex;-->
<!--            overflow: hidden;-->
<!--            background: #1e1e1e;-->
<!--        }-->

<!--        .line-numbers-area {-->
<!--            display: flex;-->
<!--            background: #252525;-->
<!--            border-right: 1px solid #3a3a3a;-->
<!--        }-->

<!--        .fold-icons {-->
<!--            min-width: 20px;-->
<!--            padding: 15px 5px;-->
<!--            font-family: 'Consolas', 'Courier New', monospace;-->
<!--            font-size: 13px;-->
<!--            line-height: 21px;-->
<!--            text-align: center;-->
<!--            user-select: none;-->
<!--            overflow: hidden;-->
<!--        }-->

<!--        .fold-arrow {-->
<!--            cursor: pointer;-->
<!--            color: #858585;-->
<!--            display: block;-->
<!--            height: 21px;-->
<!--        }-->

<!--        .fold-arrow:hover {-->
<!--            color: #fff;-->
<!--        }-->

<!--        .line-numbers {-->
<!--            min-width: 35px;-->
<!--            padding: 15px 8px;-->
<!--            font-family: 'Consolas', 'Courier New', monospace;-->
<!--            font-size: 13px;-->
<!--            line-height: 21px;-->
<!--            text-align: right;-->
<!--            color: #858585;-->
<!--            user-select: none;-->
<!--            overflow: hidden;-->
<!--            white-space: pre;-->
<!--        }-->

<!--        .code-editor {-->
<!--            flex: 1;-->
<!--            background: #1e1e1e;-->
<!--            color: #d4d4d4;-->
<!--            padding: 15px;-->
<!--            font-family: 'Consolas', 'Courier New', monospace;-->
<!--            font-size: 13px;-->
<!--            line-height: 21px;-->
<!--            overflow: auto;-->
<!--            white-space: pre-wrap;-->
<!--            word-wrap: break-word;-->
<!--            tab-size: 2;-->
<!--        }-->

<!--        .code-line {-->
<!--            min-height: 21px;-->
<!--        }-->

<!--        .key {-->
<!--            color: #9cdcfe;-->
<!--        }-->

<!--        .string {-->
<!--            color: #ce9178;-->
<!--        }-->

<!--        .number {-->
<!--            color: #b5cea8;-->
<!--        }-->

<!--        .boolean {-->
<!--            color: #569cd6;-->
<!--        }-->

<!--        .null {-->
<!--            color: #569cd6;-->
<!--        }-->

<!--        .bracket {-->
<!--            color: #ffd700;-->
<!--        }-->

<!--        .tree-view {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            background: #1e1e1e;-->
<!--            color: #d4d4d4;-->
<!--            padding: 15px;-->
<!--            font-family: 'Consolas', 'Courier New', monospace;-->
<!--            font-size: 13px;-->
<!--            line-height: 1.8;-->
<!--            overflow: auto;-->
<!--        }-->

<!--        .tree-expand {-->
<!--            cursor: pointer;-->
<!--            color: #858585;-->
<!--            user-select: none;-->
<!--            display: inline-block;-->
<!--            width: 15px;-->
<!--        }-->

<!--        .tree-expand:hover {-->
<!--            color: #fff;-->
<!--        }-->

<!--        .tree-count {-->
<!--            color: #858585;-->
<!--            margin-left: 5px;-->
<!--            font-size: 12px;-->
<!--        }-->

<!--        .tree-key {-->
<!--            color: #9cdcfe;-->
<!--        }-->

<!--        .tree-string {-->
<!--            color: #ce9178;-->
<!--        }-->

<!--        .tree-number {-->
<!--            color: #b5cea8;-->
<!--        }-->

<!--        .tree-boolean {-->
<!--            color: #569cd6;-->
<!--        }-->

<!--        .tree-null {-->
<!--            color: #569cd6;-->
<!--        }-->

<!--        .error {-->
<!--            background: #3a1a1a;-->
<!--            color: #ff6b6b;-->
<!--            padding: 15px;-->
<!--            margin: 15px;-->
<!--            border-left: 3px solid #ff6b6b;-->
<!--            border-radius: 4px;-->
<!--        }-->

<!--        .status {-->
<!--            background: #2a2a2a;-->
<!--            padding: 8px 15px;-->
<!--            font-size: 12px;-->
<!--            color: #858585;-->
<!--            border-top: 1px solid #3a3a3a;-->
<!--        }-->

<!--        .success {-->
<!--            color: #5a9f5a;-->
<!--        }-->

<!--        .warning {-->
<!--            color: #f4a742;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<div class="header">-->
<!--    <h1>JSON/XML Formatter & Minifier</h1>-->
<!--</div>-->

<!--<div class="controls">-->
<!--    <select id="formatType">-->
<!--        <option value="json">JSON</option>-->
<!--        <option value="xml">XML</option>-->
<!--    </select>-->
<!--    <button class="btn" onclick="formatCode()">Format</button>-->
<!--    <button class="btn" onclick="minifyCode()">Minify</button>-->
<!--    <button class="btn" onclick="repairCode()">Repair</button>-->
<!--    <button class="btn btn-secondary" onclick="clearAll()">Clear</button>-->
<!--    <button class="btn btn-secondary" onclick="loadSample()">Load Sample</button>-->
<!--</div>-->

<!--<div class="container">-->
<!--    <div class="panel">-->
<!--        <div class="panel-header">Input (Formatted View)</div>-->
<!--        <div class="editor-wrapper">-->
<!--            <div class="line-numbers-area">-->
<!--                <div class="fold-icons" id="foldIcons"></div>-->
<!--                <div class="line-numbers" id="lineNumbers"></div>-->
<!--            </div>-->
<!--            <div class="code-editor" id="codeEditor" contenteditable="true" spellcheck="false"></div>-->
<!--        </div>-->
<!--        <div class="status" id="inputStatus">Ready - Type or paste JSON/XML here</div>-->
<!--    </div>-->

<!--    <div class="panel">-->
<!--        <div class="panel-header">Output (Tree View)</div>-->
<!--        <div class="editor-wrapper">-->
<!--            <div class="tree-view" id="treeView"></div>-->
<!--        </div>-->
<!--        <div class="status" id="outputStatus">Ready</div>-->
<!--    </div>-->
<!--</div>-->

<!--<script>-->
<!--    let currentData = null;-->
<!--    let expandedStates = {};-->
<!--    let foldStates = {};-->
<!--    let foldHierarchy = {}; // Track parent-child relationships-->

<!--    const codeEditor = document.getElementById('codeEditor');-->

<!--    codeEditor.addEventListener('input', updateLineNumbers);-->
<!--    codeEditor.addEventListener('scroll', syncScroll);-->
<!--    codeEditor.addEventListener('paste', handlePaste);-->

<!--    function handlePaste(e) {-->
<!--        e.preventDefault();-->
<!--        const text = e.clipboardData.getData('text/plain');-->
<!--        document.execCommand('insertText', false, text);-->
<!--    }-->

<!--    function syncScroll() {-->
<!--        document.getElementById('lineNumbers').scrollTop = codeEditor.scrollTop;-->
<!--        document.getElementById('foldIcons').scrollTop = codeEditor.scrollTop;-->
<!--    }-->

<!--    function updateLineNumbers() {-->
<!--        const text = codeEditor.textContent || codeEditor.innerText || '';-->
<!--        const lines = text.split('\n').length;-->
<!--        let numbers = '';-->
<!--        for (let i = 1; i <= lines; i++) {-->
<!--            numbers += i + '\n';-->
<!--        }-->
<!--        document.getElementById('lineNumbers').textContent = numbers;-->

<!--        if (Object.keys(foldHierarchy).length === 0) {-->
<!--            document.getElementById('foldIcons').innerHTML = '';-->
<!--        }-->
<!--    }-->

<!--    function toggleFold(foldId) {-->
<!--        foldStates[foldId] = !foldStates[foldId];-->

<!--        const arrow = document.getElementById('arrow_' + foldId);-->
<!--        if (foldStates[foldId]) {-->
<!--            arrow.textContent = '▶';-->
<!--            hideAllDescendants(foldId);-->
<!--        } else {-->
<!--            arrow.textContent = '▼';-->
<!--            showDirectChildren(foldId);-->
<!--        }-->
<!--    }-->

<!--    function hideAllDescendants(foldId) {-->
<!--        // Hide all direct children lines-->
<!--        document.querySelectorAll(`[data-parent="${foldId}"]`).forEach(el => {-->
<!--            el.style.display = 'none';-->
<!--        });-->

<!--        // Recursively hide all nested folds-->
<!--        if (foldHierarchy[foldId]) {-->
<!--            foldHierarchy[foldId].forEach(childId => {-->
<!--                const childArrow = document.getElementById('arrow_' + childId);-->
<!--                if (childArrow) {-->
<!--                    childArrow.style.display = 'none';-->
<!--                }-->
<!--                hideAllDescendants(childId);-->
<!--            });-->
<!--        }-->
<!--    }-->

<!--    function showDirectChildren(foldId) {-->
<!--        // Show all direct children-->
<!--        document.querySelectorAll(`[data-parent="${foldId}"]`).forEach(el => {-->
<!--            el.style.display = 'block';-->
<!--        });-->

<!--        // Show direct child fold arrows-->
<!--        if (foldHierarchy[foldId]) {-->
<!--            foldHierarchy[foldId].forEach(childId => {-->
<!--                const childArrow = document.getElementById('arrow_' + childId);-->
<!--                if (childArrow) {-->
<!--                    childArrow.style.display = 'block';-->
<!--                }-->
<!--                // Don't show nested children if child is folded-->
<!--                if (!foldStates[childId]) {-->
<!--                    showDirectChildren(childId);-->
<!--                }-->
<!--            });-->
<!--        }-->
<!--    }-->

<!--    function renderColoredCode(json) {-->
<!--        const lines = json.split('\n');-->
<!--        let codeHtml = '';-->
<!--        let numbersHtml = '';-->
<!--        let iconsHtml = '';-->
<!--        let foldId = 0;-->
<!--        let stack = [];-->
<!--        foldHierarchy = {};-->

<!--        lines.forEach((line, idx) => {-->
<!--            const trimmed = line.trim();-->
<!--            const indent = line.length - line.trimLeft().length;-->
<!--            const spaces = ' '.repeat(indent);-->
<!--            const lineNum = idx + 1;-->

<!--            const currentParent = stack.length > 0 ? stack[stack.length - 1] : null;-->

<!--            if (trimmed.startsWith('{') || trimmed.startsWith('[')) {-->
<!--                const id = 'fold_' + (foldId++);-->
<!--                stack.push(id);-->

<!--                // Track hierarchy-->
<!--                if (currentParent) {-->
<!--                    if (!foldHierarchy[currentParent]) {-->
<!--                        foldHierarchy[currentParent] = [];-->
<!--                    }-->
<!--                    foldHierarchy[currentParent].push(id);-->
<!--                }-->

<!--                // Code line-->
<!--                if (currentParent) {-->
<!--                    codeHtml += `<div class="code-line" data-parent="${currentParent}">${spaces}${highlightSyntax(trimmed)}</div>`;-->
<!--                } else {-->
<!--                    codeHtml += `<div class="code-line">${spaces}${highlightSyntax(trimmed)}</div>`;-->
<!--                }-->

<!--                // Number line-->
<!--                if (currentParent) {-->
<!--                    numbersHtml += `<div class="code-line" data-parent="${currentParent}">${lineNum}</div>`;-->
<!--                } else {-->
<!--                    numbersHtml += `<div class="code-line">${lineNum}</div>`;-->
<!--                }-->

<!--                // Icon with fold arrow-->
<!--                if (currentParent) {-->
<!--                    iconsHtml += `<div class="fold-arrow" data-parent="${currentParent}" id="arrow_${id}" onclick="toggleFold('${id}')">▼</div>`;-->
<!--                } else {-->
<!--                    iconsHtml += `<div class="fold-arrow" id="arrow_${id}" onclick="toggleFold('${id}')">▼</div>`;-->
<!--                }-->

<!--            } else if (trimmed === '}' || trimmed === '},' || trimmed === ']' || trimmed === '],') {-->
<!--                stack.pop();-->
<!--                const newParent = stack.length > 0 ? stack[stack.length - 1] : null;-->

<!--                if (newParent) {-->
<!--                    codeHtml += `<div class="code-line" data-parent="${newParent}">${spaces}${highlightSyntax(trimmed)}</div>`;-->
<!--                    numbersHtml += `<div class="code-line" data-parent="${newParent}">${lineNum}</div>`;-->
<!--                    iconsHtml += `<div class="fold-arrow" data-parent="${newParent}"></div>`;-->
<!--                } else {-->
<!--                    codeHtml += `<div class="code-line">${spaces}${highlightSyntax(trimmed)}</div>`;-->
<!--                    numbersHtml += `<div class="code-line">${lineNum}</div>`;-->
<!--                    iconsHtml += `<div class="fold-arrow"></div>`;-->
<!--                }-->
<!--            } else {-->
<!--                if (currentParent) {-->
<!--                    codeHtml += `<div class="code-line" data-parent="${currentParent}">${spaces}${highlightSyntax(trimmed)}</div>`;-->
<!--                    numbersHtml += `<div class="code-line" data-parent="${currentParent}">${lineNum}</div>`;-->
<!--                    iconsHtml += `<div class="fold-arrow" data-parent="${currentParent}"></div>`;-->
<!--                } else {-->
<!--                    codeHtml += `<div class="code-line">${spaces}${highlightSyntax(trimmed)}</div>`;-->
<!--                    numbersHtml += `<div class="code-line">${lineNum}</div>`;-->
<!--                    iconsHtml += `<div class="fold-arrow"></div>`;-->
<!--                }-->
<!--            }-->
<!--        });-->

<!--        return { code: codeHtml, numbers: numbersHtml, icons: iconsHtml };-->
<!--    }-->

<!--    // function highlightSyntax(text) {-->
<!--    //     return text-->
<!--    //         .replace(/&/g, '&amp;')-->
<!--    //         .replace(/</g, '&lt;')-->
<!--    //         .replace(/>/g, '&gt;')-->
<!--    //         .replace(/"([^"]+)":/g, '<span class="key">"$1"</span>:')-->
<!--    //         .replace(/:\s*"([^"]*)"/g, ': <span class="string">"$1"</span>')-->
<!--    //         .replace(/:\s*(\d+\.?\d*)/g, ': <span class="number">$1</span>')-->
<!--    //         .replace(/:\s*(true|false)/g, ': <span class="boolean">$1</span>')-->
<!--    //         .replace(/:\s*(null)/g, ': <span class="null">$1</span>')-->
<!--    //         .replace(/([{}\[\]])/g, '<span class="bracket">$1</span>')-->
<!--    //         .replace(/,(?![^"]*")/g, '<span class="bracket">,</span>');-->
<!--    // }-->


<!--    function formatCode() {-->
<!--        const input = (codeEditor.textContent || codeEditor.innerText || '').trim();-->
<!--        const type = document.getElementById('formatType').value;-->
<!--        const inputStatus = document.getElementById('inputStatus');-->

<!--        if (!input) {-->
<!--            inputStatus.innerHTML = '<span class="warning">Please enter some code first!</span>';-->
<!--            return;-->
<!--        }-->

<!--        try {-->
<!--            if (type === 'json') {-->
<!--                const parsed = JSON.parse(input);-->
<!--                currentData = parsed;-->
<!--                const formatted = JSON.stringify(parsed, null, 2);-->

<!--                const rendered = renderColoredCode(formatted);-->
<!--                codeEditor.innerHTML = rendered.code;-->
<!--                document.getElementById('lineNumbers').innerHTML = rendered.numbers;-->
<!--                document.getElementById('foldIcons').innerHTML = rendered.icons;-->

<!--                foldStates = {};-->
<!--                renderTree(parsed);-->

<!--                inputStatus.innerHTML = '<span class="success">✓ JSON formatted successfully!</span>';-->
<!--                document.getElementById('outputStatus').innerHTML = '<span class="success">✓ Tree view generated</span>';-->
<!--            } else {-->
<!--                const formatted = formatXML(input);-->
<!--                const highlighted = highlightXML(formatted);-->
<!--                codeEditor.textContent = formatted;-->
<!--                updateLineNumbers();-->
<!--                foldHierarchy = {};-->
<!--                document.getElementById('foldIcons').innerHTML = '';-->
<!--                const parsed = parseXMLToObject(input);-->
<!--                currentData = parsed;-->
<!--                renderTree(parsed);-->
<!--                inputStatus.innerHTML = '<span class="success">✓ XML formatted successfully!</span>';-->
<!--                document.getElementById('outputStatus').innerHTML = '<span class="success">✓ Tree view generated</span>';-->
<!--            }-->
<!--        } catch (e) {-->
<!--            inputStatus.innerHTML = '<span style="color: #ff6b6b">✗ Error: ' + e.message + '</span>';-->
<!--            document.getElementById('treeView').innerHTML = '<div class="error">Parse Error: ' + e.message + '</div>';-->
<!--        }-->
<!--    }-->

<!--    function minifyCode() {-->
<!--        const input = (codeEditor.textContent || codeEditor.innerText || '').trim();-->
<!--        const type = document.getElementById('formatType').value;-->
<!--        const inputStatus = document.getElementById('inputStatus');-->

<!--        if (!input) {-->
<!--            inputStatus.innerHTML = '<span class="warning">Please enter some code first!</span>';-->
<!--            return;-->
<!--        }-->

<!--        try {-->
<!--            if (type === 'json') {-->
<!--                const parsed = JSON.parse(input);-->
<!--                const minified = JSON.stringify(parsed);-->
<!--                codeEditor.textContent = minified;-->
<!--                foldHierarchy = {};-->
<!--                document.getElementById('foldIcons').innerHTML = '';-->
<!--                updateLineNumbers();-->

<!--                currentData = parsed;-->
<!--                renderTree(parsed);-->

<!--                inputStatus.innerHTML = '<span class="success">✓ JSON minified successfully!</span>';-->
<!--                document.getElementById('outputStatus').innerHTML = '<span class="success">✓ Tree view updated</span>';-->
<!--            } else {-->
<!--                const minified = input.replace(/>\s+</g, '><').trim();-->
<!--                codeEditor.textContent = minified;-->
<!--                foldHierarchy = {};-->
<!--                document.getElementById('foldIcons').innerHTML = '';-->
<!--                updateLineNumbers();-->
<!--                inputStatus.innerHTML = '<span class="success">✓ XML minified successfully!</span>';-->
<!--            }-->
<!--        } catch (e) {-->
<!--            inputStatus.innerHTML = '<span style="color: #ff6b6b">✗ Error: ' + e.message + '</span>';-->
<!--        }-->
<!--    }-->

<!--    function repairCode() {-->
<!--        const input = (codeEditor.textContent || codeEditor.innerText || '').trim();-->
<!--        const type = document.getElementById('formatType').value;-->
<!--        const inputStatus = document.getElementById('inputStatus');-->

<!--        if (!input) {-->
<!--            inputStatus.innerHTML = '<span class="warning">Please enter some code first!</span>';-->
<!--            return;-->
<!--        }-->

<!--        try {-->
<!--            if (type === 'json') {-->
<!--                let repaired = input-->
<!--                    .replace(/,(\s*[}\]])/g, '$1')-->
<!--                    .replace(/([{,]\s*)(\w+)(\s*):/g, '$1"$2"$3:')-->
<!--                    .replace(/'([^']*)'/g, '"$1"');-->

<!--                const parsed = JSON.parse(repaired);-->
<!--                const formatted = JSON.stringify(parsed, null, 2);-->

<!--                const rendered = renderColoredCode(formatted);-->
<!--                codeEditor.innerHTML = rendered.code;-->
<!--                document.getElementById('lineNumbers').innerHTML = rendered.numbers;-->
<!--                document.getElementById('foldIcons').innerHTML = rendered.icons;-->

<!--                foldStates = {};-->
<!--                currentData = parsed;-->
<!--                renderTree(parsed);-->

<!--                inputStatus.innerHTML = '<span class="success">✓ JSON repaired and formatted!</span>';-->
<!--                document.getElementById('outputStatus').innerHTML = '<span class="success">✓ Tree view updated</span>';-->
<!--            } else {-->
<!--                const formatted = formatXML(input);-->
<!--                codeEditor.textContent = formatted;-->
<!--                updateLineNumbers();-->
<!--                inputStatus.innerHTML = '<span class="success">✓ XML repaired and formatted!</span>';-->
<!--            }-->
<!--        } catch (e) {-->
<!--            inputStatus.innerHTML = '<span style="color: #ff6b6b">✗ Could not repair: ' + e.message + '</span>';-->
<!--        }-->
<!--    }-->

<!--    function formatXML(xml) {-->
<!--        let formatted = '';-->
<!--        let indent = '';-->
<!--        xml.split(/>\s*</).forEach(function(node) {-->
<!--            if (node.match(/^\/\w/)) indent = indent.substring(2);-->
<!--            formatted += indent + '<' + node + '>\n';-->
<!--            if (node.match(/^<?\w[^>]*[^\/]$/)) indent += '  ';-->
<!--        });-->
<!--        return formatted.substring(1, formatted.length - 2);-->
<!--    }-->

<!--    function parseXMLToObject(xml) {-->
<!--        const parser = new DOMParser();-->
<!--        const doc = parser.parseFromString(xml, 'text/xml');-->

<!--        function xmlToJson(node) {-->
<!--            if (node.nodeType === 3) return node.nodeValue.trim();-->
<!--            let obj = {};-->
<!--            if (node.attributes && node.attributes.length > 0) {-->
<!--                for (let i = 0; i < node.attributes.length; i++) {-->
<!--                    obj['@' + node.attributes[i].name] = node.attributes[i].value;-->
<!--                }-->
<!--            }-->
<!--            if (node.hasChildNodes()) {-->
<!--                for (let i = 0; i < node.childNodes.length; i++) {-->
<!--                    const child = node.childNodes[i];-->
<!--                    const name = child.nodeName;-->
<!--                    if (child.nodeType === 3) {-->
<!--                        const text = child.nodeValue.trim();-->
<!--                        if (text) return text;-->
<!--                    } else {-->
<!--                        if (typeof obj[name] === 'undefined') {-->
<!--                            obj[name] = xmlToJson(child);-->
<!--                        } else {-->
<!--                            if (!Array.isArray(obj[name])) obj[name] = [obj[name]];-->
<!--                            obj[name].push(xmlToJson(child));-->
<!--                        }-->
<!--                    }-->
<!--                }-->
<!--            }-->
<!--            return obj;-->
<!--        }-->
<!--        return { [doc.documentElement.nodeName]: xmlToJson(doc.documentElement) };-->
<!--    }-->

<!--    function renderTree(data) {-->
<!--        const treeView = document.getElementById('treeView');-->
<!--        treeView.innerHTML = '';-->

<!--        function renderNode(obj, parent, key = 'root', level = 0, path = '') {-->
<!--            const nodeId = path + '_' + key;-->

<!--            if (Array.isArray(obj)) {-->
<!--                const count = obj.length;-->
<!--                const isExpanded = expandedStates[nodeId] !== false;-->

<!--                const toggle = document.createElement('span');-->
<!--                toggle.className = 'tree-expand';-->
<!--                toggle.textContent = isExpanded ? '▼' : '▶';-->
<!--                toggle.onclick = function() {-->
<!--                    expandedStates[nodeId] = !isExpanded;-->
<!--                    renderTree(currentData);-->
<!--                };-->

<!--                const line = document.createElement('div');-->
<!--                line.style.marginLeft = (level * 20) + 'px';-->
<!--                line.appendChild(toggle);-->

<!--                const keySpan = document.createElement('span');-->
<!--                keySpan.className = 'tree-key';-->
<!--                keySpan.textContent = key;-->
<!--                line.appendChild(keySpan);-->

<!--                line.appendChild(document.createTextNode(' : ['));-->

<!--                const countSpan = document.createElement('span');-->
<!--                countSpan.className = 'tree-count';-->
<!--                countSpan.textContent = count + ' items';-->
<!--                line.appendChild(countSpan);-->

<!--                line.appendChild(document.createTextNode(' ]'));-->
<!--                parent.appendChild(line);-->

<!--                if (isExpanded) {-->
<!--                    obj.forEach((item, index) => {-->
<!--                        renderNode(item, parent, index.toString(), level + 1, nodeId);-->
<!--                    });-->
<!--                }-->
<!--            } else if (typeof obj === 'object' && obj !== null) {-->
<!--                const keys = Object.keys(obj);-->
<!--                const count = keys.length;-->
<!--                const isExpanded = expandedStates[nodeId] !== false;-->

<!--                const toggle = document.createElement('span');-->
<!--                toggle.className = 'tree-expand';-->
<!--                toggle.textContent = isExpanded ? '▼' : '▶';-->
<!--                toggle.onclick = function() {-->
<!--                    expandedStates[nodeId] = !isExpanded;-->
<!--                    renderTree(currentData);-->
<!--                };-->

<!--                const line = document.createElement('div');-->
<!--                line.style.marginLeft = (level * 20) + 'px';-->
<!--                line.appendChild(toggle);-->

<!--                const keySpan = document.createElement('span');-->
<!--                keySpan.className = 'tree-key';-->
<!--                keySpan.textContent = key;-->
<!--                line.appendChild(keySpan);-->

<!--                line.appendChild(document.createTextNode(' : {'));-->

<!--                const countSpan = document.createElement('span');-->
<!--                countSpan.className = 'tree-count';-->
<!--                countSpan.textContent = count + ' props';-->
<!--                line.appendChild(countSpan);-->

<!--                line.appendChild(document.createTextNode(' }'));-->
<!--                parent.appendChild(line);-->

<!--                if (isExpanded) {-->
<!--                    keys.forEach(k => {-->
<!--                        renderNode(obj[k], parent, k, level + 1, nodeId);-->
<!--                    });-->
<!--                }-->
<!--            } else {-->
<!--                const line = document.createElement('div');-->
<!--                line.style.marginLeft = (level * 20) + 'px';-->
<!--                line.textContent = '  ';-->

<!--                const keySpan = document.createElement('span');-->
<!--                keySpan.className = 'tree-key';-->
<!--                keySpan.textContent = key;-->
<!--                line.appendChild(keySpan);-->

<!--                line.appendChild(document.createTextNode(' : '));-->

<!--                const valueSpan = document.createElement('span');-->
<!--                if (typeof obj === 'string') {-->
<!--                    valueSpan.className = 'tree-string';-->
<!--                    valueSpan.textContent = '"' + obj + '"';-->
<!--                } else if (typeof obj === 'number') {-->
<!--                    valueSpan.className = 'tree-number';-->
<!--                    valueSpan.textContent = obj;-->
<!--                } else if (typeof obj === 'boolean') {-->
<!--                    valueSpan.className = 'tree-boolean';-->
<!--                    valueSpan.textContent = obj;-->
<!--                } else if (obj === null) {-->
<!--                    valueSpan.className = 'tree-null';-->
<!--                    valueSpan.textContent = 'null';-->
<!--                }-->
<!--                line.appendChild(valueSpan);-->
<!--                parent.appendChild(line);-->
<!--            }-->
<!--        }-->

<!--        renderNode(data, treeView);-->
<!--    }-->

<!--    function clearAll() {-->
<!--        codeEditor.textContent = '';-->
<!--        document.getElementById('foldIcons').innerHTML = '';-->
<!--        document.getElementById('treeView').innerHTML = '<div style="padding: 20px; color: #858585;">Tree view will appear here after formatting</div>';-->
<!--        updateLineNumbers();-->
<!--        currentData = null;-->
<!--        expandedStates = {};-->
<!--        foldStates = {};-->
<!--        foldHierarchy = {};-->
<!--        document.getElementById('inputStatus').textContent = 'Cleared';-->
<!--        document.getElementById('outputStatus').textContent = 'Cleared';-->
<!--    }-->
<!--    function highlightXML(xmlString) {-->
<!--        // Escape HTML first-->
<!--        let result = xmlString-->
<!--            .replace(/&/g, '&amp;')-->
<!--            .replace(/</g, '&lt;')-->
<!--            .replace(/>/g, '&gt;');-->

<!--        // XML Declaration: <?xml ... ?>-->
<!--        result = result.replace(/(&lt;\?)(xml)(.*?)(\?&gt;)/g,-->
<!--            '<span class="bracket">$1</span><span class="key">$2</span><span class="string">$3</span><span class="bracket">$4</span>');-->

<!--        // Opening tags with attributes: <tagName attr="value">-->
<!--        result = result.replace(/(&lt;)([\w:-]+)((?:\s+[\w:-]+\s*=\s*"[^"]*")*)\s*(&gt;)/g, function(match, lt, tagName, attrs, gt) {-->
<!--            let highlighted = '<span class="bracket">' + lt + '</span><span class="key">' + tagName + '</span>';-->
<!--            if (attrs.trim()) {-->
<!--                highlighted += attrs.replace(/([\w:-]+)\s*=\s*"([^"]*)"/g, ' <span class="string">$1</span>=<span class="number">"$2"</span>');-->
<!--            }-->
<!--            highlighted += '<span class="bracket">' + gt + '</span>';-->
<!--            return highlighted;-->
<!--        });-->

<!--        // Self-closing tags: <tagName />-->
<!--        result = result.replace(/(&lt;)([\w:-]+)((?:\s+[\w:-]+\s*=\s*"[^"]*")*)\s*(\/&gt;)/g, function(match, lt, tagName, attrs, slashGt) {-->
<!--            let highlighted = '<span class="bracket">' + lt + '</span><span class="key">' + tagName + '</span>';-->
<!--            if (attrs.trim()) {-->
<!--                highlighted += attrs.replace(/([\w:-]+)\s*=\s*"([^"]*)"/g, ' <span class="string">$1</span>=<span class="number">"$2"</span>');-->
<!--            }-->
<!--            highlighted += '<span class="bracket">' + slashGt + '</span>';-->
<!--            return highlighted;-->
<!--        });-->

<!--        // Closing tags: </tagName>-->
<!--        result = result.replace(/(&lt;\/)([\w:-]+)(&gt;)/g,-->
<!--            '<span class="bracket">$1</span><span class="key">$2</span><span class="bracket">$3</span>');-->

<!--        // Text content between tags (but not whitespace-only)-->
<!--        result = result.replace(/(&gt;)([^&<]+)(&lt;)/g, function(match, gt, content, lt) {-->
<!--            if (content.trim()) {-->
<!--                return gt + '<span class="string">' + content + '</span>' + lt;-->
<!--            }-->
<!--            return match;-->
<!--        });-->

<!--        return result;-->
<!--    }-->

<!--    function highlightSyntax(text) {-->
<!--        // JSON highlighting-->
<!--        return text-->
<!--            .replace(/&/g, '&amp;')-->
<!--            .replace(/</g, '&lt;')-->
<!--            .replace(/>/g, '&gt;')-->
<!--            .replace(/"([^"]+)":/g, '<span class="key">"$1"</span>:')-->
<!--            .replace(/:\s*"([^"]*)"/g, ': <span class="string">"$1"</span>')-->
<!--            .replace(/:\s*(\d+\.?\d*)/g, ': <span class="number">$1</span>')-->
<!--            .replace(/:\s*(true|false)/g, ': <span class="boolean">$1</span>')-->
<!--            .replace(/:\s*(null)/g, ': <span class="null">$1</span>')-->
<!--            .replace(/([{}\[\]])/g, '<span class="bracket">$1</span>')-->
<!--            .replace(/,(?![^"]*")/g, '<span class="bracket">,</span>');-->
<!--    }-->

<!--    function loadSample() {-->
<!--        const sample = `[-->
<!--  {-->
<!--    "label": "Activity",-->
<!--    "parameterName": "Activity.any_other_intervention_1",-->
<!--    "type": "text",-->
<!--    "parameterValue": "qdasdcasdc",-->
<!--    "stepName": "Management Interventions",-->
<!--    "required": true-->
<!--  },-->
<!--  {-->
<!--    "label": "Activity",-->
<!--    "parameterName": "Activity.Any_other_intervention_1",-->
<!--    "type": "text",-->
<!--    "parameterValue": "qdasdcasdc",-->
<!--    "stepName": "Projected Benefits",-->
<!--    "required": false-->
<!--  },-->
<!--  {-->
<!--    "label": "Activity",-->
<!--    "parameterName": "Activity.biodiversity_conservation_1",-->
<!--    "type": "text",-->
<!--    "parameterValue": "Assessment of habitat quality and species interactions",-->
<!--    "stepName": "Management Interventions",-->
<!--    "required": true-->
<!--  },-->
<!--  {-->
<!--    "label": "Activity",-->
<!--    "parameterName": "Activity.Biodiversity_Conservation_1",-->
<!--    "type": "text",-->
<!--    "parameterValue": "Assessment of habitat quality and species interactions",-->
<!--    "stepName": "Monitoring & Evaluation",-->
<!--    "required": false-->
<!--  }-->
<!--]`;-->
<!--        codeEditor.textContent = sample;-->
<!--        updateLineNumbers();-->
<!--        document.getElementById('inputStatus').innerHTML = '<span class="success">✓ Sample loaded - Click Format</span>';-->
<!--    }-->

<!--    // Initialize-->
<!--    updateLineNumbers();-->
<!--    document.getElementById('treeView').innerHTML = '<div style="padding: 20px; color: #858585;">Tree view will appear here after formatting</div>';-->
<!--</script>-->
<!--</body>-->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON/XML Formatter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #2d2d2d;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4a4a4a 0%, #3a3a3a 100%);
            padding: 15px 20px;
            border-bottom: 2px solid #555;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 500;
        }

        .controls {
            background: #3a3a3a;
            padding: 15px 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            border-bottom: 1px solid #555;
        }

        .btn {
            background: #5a9f5a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #4a8f4a;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6a6a6a;
        }

        .btn-secondary:hover {
            background: #7a7a7a;
        }

        select {
            background: #4a4a4a;
            color: white;
            border: 1px solid #666;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .container {
            display: flex;
            height: calc(100vh - 130px);
            gap: 2px;
            background: #555;
        }

        .panel {
            flex: 1;
            min-width: 0;
            max-width: 50%;
            display: flex;
            flex-direction: column;
            background: #2d2d2d;
        }

        .panel-header {
            background: #181f40;
            padding: 12px 15px;
            font-weight: 500;
            font-size: 15px;
        }

        .editor-wrapper {
            flex: 1;
            display: flex;
            overflow: hidden;
            background: #1e1e1e;
        }

        .line-numbers-area {
            display: flex;
            background: #252525;
            border-right: 1px solid #3a3a3a;
        }

        .fold-icons {
            min-width: 20px;
            padding: 15px 5px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 13px;
            line-height: 21px;
            text-align: center;
            user-select: none;
            overflow: hidden;
        }

        .fold-arrow {
            cursor: pointer;
            color: #858585;
            display: block;
            height: 21px;
        }

        .fold-arrow:hover {
            color: #fff;
        }

        .line-numbers {
            min-width: 35px;
            padding: 15px 8px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 13px;
            line-height: 21px;
            text-align: right;
            color: #858585;
            user-select: none;
            overflow: hidden;
            white-space: pre;
        }

        .code-editor {
            flex: 1;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 13px;
            line-height: 21px;
            overflow: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            tab-size: 2;
        }

        .code-line {
            min-height: 21px;
        }

        .key {
            color: #9cdcfe;
        }

        .string {
            color: #ce9178;
        }

        .number {
            color: #b5cea8;
        }

        .boolean {
            color: #569cd6;
        }

        .null {
            color: #569cd6;
        }

        .bracket {
            color: #ffd700;
        }

        .xml-tag {
            color: #569cd6;
        }

        .xml-attr {
            color: #9cdcfe;
        }

        .xml-attr-value {
            color: #ce9178;
        }

        .xml-text {
            color: #d4d4d4;
        }

        .tree-view {
            width: 100%;
            height: 100%;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.8;
            overflow: auto;
        }

        .tree-expand {
            cursor: pointer;
            color: #858585;
            user-select: none;
            display: inline-block;
            width: 15px;
        }

        .tree-expand:hover {
            color: #fff;
        }

        .tree-count {
            color: #858585;
            margin-left: 5px;
            font-size: 12px;
        }

        .tree-key {
            color: #9cdcfe;
        }

        .tree-string {
            color: #ce9178;
        }

        .tree-number {
            color: #b5cea8;
        }

        .tree-boolean {
            color: #569cd6;
        }

        .tree-null {
            color: #569cd6;
        }

        .error {
            background: #3a1a1a;
            color: #ff6b6b;
            padding: 15px;
            margin: 15px;
            border-left: 3px solid #ff6b6b;
            border-radius: 4px;
        }

        .status {
            background: #2a2a2a;
            padding: 8px 15px;
            font-size: 12px;
            color: #858585;
            border-top: 1px solid #3a3a3a;
        }

        .success {
            color: #5a9f5a;
        }

        .warning {
            color: #f4a742;
        }
    </style>
</head>
<body>
<div class="header">
    <h1>JSON/XML Formatter & Minifier</h1>
</div>

<div class="controls">
    <select id="formatType">
        <option value="json">JSON</option>
        <option value="xml">XML</option>
    </select>
    <button class="btn" onclick="formatCode()">Format</button>
    <button class="btn" onclick="minifyCode()">Minify</button>
    <button class="btn" onclick="repairCode()">Repair</button>
    <button class="btn btn-secondary" onclick="clearAll()">Clear</button>
    <button class="btn btn-secondary" onclick="loadSample()">Load Sample</button>
</div>

<div class="container">
    <div class="panel">
        <div class="panel-header">Input (Formatted View)</div>
        <div class="editor-wrapper">
            <div class="line-numbers-area">
                <div class="fold-icons" id="foldIcons"></div>
                <div class="line-numbers" id="lineNumbers"></div>
            </div>
            <div class="code-editor" id="codeEditor" contenteditable="true" spellcheck="false"></div>
        </div>
        <div class="status" id="inputStatus">Ready - Type or paste JSON/XML here</div>
    </div>

    <div class="panel">
        <div class="panel-header">Output (Tree View)</div>
        <div class="editor-wrapper">
            <div class="tree-view" id="treeView"></div>
        </div>
        <div class="status" id="outputStatus">Ready</div>
    </div>
</div>

<script>
    let currentData = null;
    let expandedStates = {};
    let foldStates = {};
    let foldHierarchy = {};

    const codeEditor = document.getElementById('codeEditor');

    codeEditor.addEventListener('input', updateLineNumbers);
    codeEditor.addEventListener('scroll', syncScroll);
    codeEditor.addEventListener('paste', handlePaste);

    function handlePaste(e) {
        e.preventDefault();
        const text = e.clipboardData.getData('text/plain');
        document.execCommand('insertText', false, text);
    }

    function syncScroll() {
        document.getElementById('lineNumbers').scrollTop = codeEditor.scrollTop;
        document.getElementById('foldIcons').scrollTop = codeEditor.scrollTop;
    }

    function updateLineNumbers() {
        const text = codeEditor.textContent || codeEditor.innerText || '';
        const lines = text.split('\n').length;
        let numbers = '';
        for (let i = 1; i <= lines; i++) {
            numbers += i + '\n';
        }
        document.getElementById('lineNumbers').textContent = numbers;

        if (Object.keys(foldHierarchy).length === 0) {
            document.getElementById('foldIcons').innerHTML = '';
        }
    }

    function toggleFold(foldId) {
        foldStates[foldId] = !foldStates[foldId];

        const arrow = document.getElementById('arrow_' + foldId);
        if (foldStates[foldId]) {
            arrow.textContent = '▶';
            hideAllDescendants(foldId);
        } else {
            arrow.textContent = '▼';
            showDirectChildren(foldId);
        }
    }

    function hideAllDescendants(foldId) {
        document.querySelectorAll(`[data-parent="${foldId}"]`).forEach(el => {
            el.style.display = 'none';
        });

        if (foldHierarchy[foldId]) {
            foldHierarchy[foldId].forEach(childId => {
                const childArrow = document.getElementById('arrow_' + childId);
                if (childArrow) {
                    childArrow.style.display = 'none';
                }
                hideAllDescendants(childId);
            });
        }
    }

    function showDirectChildren(foldId) {
        document.querySelectorAll(`[data-parent="${foldId}"]`).forEach(el => {
            el.style.display = 'block';
        });

        if (foldHierarchy[foldId]) {
            foldHierarchy[foldId].forEach(childId => {
                const childArrow = document.getElementById('arrow_' + childId);
                if (childArrow) {
                    childArrow.style.display = 'block';
                }
                if (!foldStates[childId]) {
                    showDirectChildren(childId);
                }
            });
        }
    }

    function renderColoredCode(json) {
        const lines = json.split('\n');
        let codeHtml = '';
        let numbersHtml = '';
        let iconsHtml = '';
        let foldId = 0;
        let stack = [];
        foldHierarchy = {};

        lines.forEach((line, idx) => {
            const trimmed = line.trim();
            const indent = line.length - line.trimLeft().length;
            const spaces = ' '.repeat(indent);
            const lineNum = idx + 1;

            const currentParent = stack.length > 0 ? stack[stack.length - 1] : null;

            if (trimmed.startsWith('{') || trimmed.startsWith('[')) {
                const id = 'fold_' + (foldId++);
                stack.push(id);

                if (currentParent) {
                    if (!foldHierarchy[currentParent]) {
                        foldHierarchy[currentParent] = [];
                    }
                    foldHierarchy[currentParent].push(id);
                }

                if (currentParent) {
                    codeHtml += `<div class="code-line" data-parent="${currentParent}">${spaces}${highlightSyntax(trimmed)}</div>`;
                } else {
                    codeHtml += `<div class="code-line">${spaces}${highlightSyntax(trimmed)}</div>`;
                }

                if (currentParent) {
                    numbersHtml += `<div class="code-line" data-parent="${currentParent}">${lineNum}</div>`;
                } else {
                    numbersHtml += `<div class="code-line">${lineNum}</div>`;
                }

                if (currentParent) {
                    iconsHtml += `<div class="fold-arrow" data-parent="${currentParent}" id="arrow_${id}" onclick="toggleFold('${id}')">▼</div>`;
                } else {
                    iconsHtml += `<div class="fold-arrow" id="arrow_${id}" onclick="toggleFold('${id}')">▼</div>`;
                }

            } else if (trimmed === '}' || trimmed === '},' || trimmed === ']' || trimmed === '],') {
                stack.pop();
                const newParent = stack.length > 0 ? stack[stack.length - 1] : null;

                if (newParent) {
                    codeHtml += `<div class="code-line" data-parent="${newParent}">${spaces}${highlightSyntax(trimmed)}</div>`;
                    numbersHtml += `<div class="code-line" data-parent="${newParent}">${lineNum}</div>`;
                    iconsHtml += `<div class="fold-arrow" data-parent="${newParent}"></div>`;
                } else {
                    codeHtml += `<div class="code-line">${spaces}${highlightSyntax(trimmed)}</div>`;
                    numbersHtml += `<div class="code-line">${lineNum}</div>`;
                    iconsHtml += `<div class="fold-arrow"></div>`;
                }
            } else {
                if (currentParent) {
                    codeHtml += `<div class="code-line" data-parent="${currentParent}">${spaces}${highlightSyntax(trimmed)}</div>`;
                    numbersHtml += `<div class="code-line" data-parent="${currentParent}">${lineNum}</div>`;
                    iconsHtml += `<div class="fold-arrow" data-parent="${currentParent}"></div>`;
                } else {
                    codeHtml += `<div class="code-line">${spaces}${highlightSyntax(trimmed)}</div>`;
                    numbersHtml += `<div class="code-line">${lineNum}</div>`;
                    iconsHtml += `<div class="fold-arrow"></div>`;
                }
            }
        });

        return { code: codeHtml, numbers: numbersHtml, icons: iconsHtml };
    }

    function highlightSyntax(text) {
        return text
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"([^"]+)":/g, '<span class="key">"$1"</span>:')
            .replace(/:\s*"([^"]*)"/g, ': <span class="string">"$1"</span>')
            .replace(/:\s*(\d+\.?\d*)/g, ': <span class="number">$1</span>')
            .replace(/:\s*(true|false)/g, ': <span class="boolean">$1</span>')
            .replace(/:\s*(null)/g, ': <span class="null">$1</span>')
            .replace(/([{}\[\]])/g, '<span class="bracket">$1</span>')
            .replace(/,(?![^"]*")/g, '<span class="bracket">,</span>');
    }

    function highlightXMLLine(line) {
        let result = line
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');

        // XML declaration
        result = result.replace(/(&lt;\?xml\s+)(.*?)(\?&gt;)/g, function(match, start, attrs, end) {
            let highlighted = '<span class="xml-tag">' + start + '</span>';
            highlighted += attrs.replace(/([\w:-]+)\s*=\s*"([^"]*)"/g, '<span class="xml-attr">$1</span>=<span class="xml-attr-value">"$2"</span>');
            highlighted += '<span class="xml-tag">' + end + '</span>';
            return highlighted;
        });

        // Opening and self-closing tags
        result = result.replace(/(&lt;)([\w:-]+)((?:\s+[\w:-]+\s*=\s*"[^"]*")*)\s*(\/?)(&gt;)/g, function(match, lt, tagName, attrs, slash, gt) {
            let highlighted = '<span class="bracket">&lt;</span><span class="xml-tag">' + tagName + '</span>';
            if (attrs.trim()) {
                highlighted += attrs.replace(/([\w:-]+)\s*=\s*"([^"]*)"/g, ' <span class="xml-attr">$1</span>=<span class="xml-attr-value">"$2"</span>');
            }
            if (slash) {
                highlighted += '<span class="bracket">/</span>';
            }
            highlighted += '<span class="bracket">&gt;</span>';
            return highlighted;
        });

        // Closing tags
        result = result.replace(/(&lt;\/)([\w:-]+)(&gt;)/g, '<span class="bracket">&lt;/</span><span class="xml-tag">$2</span><span class="bracket">&gt;</span>');

        // Text content between tags
        result = result.replace(/(&gt;)([^&<]+)(&lt;)/g, function(match, gt, content, lt) {
            if (content.trim()) {
                return gt + '<span class="xml-text">' + content + '</span>' + lt;
            }
            return match;
        });

        return result;
    }

    function formatCode() {
        const input = (codeEditor.textContent || codeEditor.innerText || '').trim();
        const type = document.getElementById('formatType').value;
        const inputStatus = document.getElementById('inputStatus');

        if (!input) {
            inputStatus.innerHTML = '<span class="warning">Please enter some code first!</span>';
            return;
        }

        try {
            if (type === 'json') {
                const parsed = JSON.parse(input);
                currentData = parsed;
                const formatted = JSON.stringify(parsed, null, 2);

                const rendered = renderColoredCode(formatted);
                codeEditor.innerHTML = rendered.code;
                document.getElementById('lineNumbers').innerHTML = rendered.numbers;
                document.getElementById('foldIcons').innerHTML = rendered.icons;

                foldStates = {};
                renderTree(parsed);

                inputStatus.innerHTML = '<span class="success">✓ JSON formatted successfully!</span>';
                document.getElementById('outputStatus').innerHTML = '<span class="success">✓ Tree view generated</span>';
            } else {
                const formatted = formatXML(input);
                const lines = formatted.split('\n');

                let codeHtml = '';
                let numbersHtml = '';

                lines.forEach((line, idx) => {
                    const highlighted = highlightXMLLine(line);
                    codeHtml += `<div class="code-line">${highlighted}</div>`;
                    numbersHtml += `<div class="code-line">${idx + 1}</div>`;
                });

                codeEditor.innerHTML = codeHtml;
                document.getElementById('lineNumbers').innerHTML = numbersHtml;
                document.getElementById('foldIcons').innerHTML = '';
                foldHierarchy = {};

                const parsed = parseXMLToObject(input);
                currentData = parsed;
                renderTree(parsed);
                inputStatus.innerHTML = '<span class="success">✓ XML formatted successfully!</span>';
                document.getElementById('outputStatus').innerHTML = '<span class="success">✓ Tree view generated</span>';
            }
        } catch (e) {
            inputStatus.innerHTML = '<span style="color: #ff6b6b">✗ Error: ' + e.message + '</span>';
            document.getElementById('treeView').innerHTML = '<div class="error">Parse Error: ' + e.message + '</div>';
        }
    }

    function minifyCode() {
        const input = (codeEditor.textContent || codeEditor.innerText || '').trim();
        const type = document.getElementById('formatType').value;
        const inputStatus = document.getElementById('inputStatus');

        if (!input) {
            inputStatus.innerHTML = '<span class="warning">Please enter some code first!</span>';
            return;
        }

        try {
            if (type === 'json') {
                const parsed = JSON.parse(input);
                const minified = JSON.stringify(parsed);
                codeEditor.textContent = minified;
                foldHierarchy = {};
                document.getElementById('foldIcons').innerHTML = '';
                updateLineNumbers();

                currentData = parsed;
                renderTree(parsed);

                inputStatus.innerHTML = '<span class="success">✓ JSON minified successfully!</span>';
                document.getElementById('outputStatus').innerHTML = '<span class="success">✓ Tree view updated</span>';
            } else {
                const minified = input.replace(/>\s+</g, '><').trim();
                codeEditor.textContent = minified;
                foldHierarchy = {};
                document.getElementById('foldIcons').innerHTML = '';
                updateLineNumbers();
                inputStatus.innerHTML = '<span class="success">✓ XML minified successfully!</span>';
            }
        } catch (e) {
            inputStatus.innerHTML = '<span style="color: #ff6b6b">✗ Error: ' + e.message + '</span>';
        }
    }

    function repairCode() {
        const input = (codeEditor.textContent || codeEditor.innerText || '').trim();
        const type = document.getElementById('formatType').value;
        const inputStatus = document.getElementById('inputStatus');

        if (!input) {
            inputStatus.innerHTML = '<span class="warning">Please enter some code first!</span>';
            return;
        }

        try {
            if (type === 'json') {
                let repaired = input
                    .replace(/,(\s*[}\]])/g, '$1')
                    .replace(/([{,]\s*)(\w+)(\s*):/g, '$1"$2"$3:')
                    .replace(/'([^']*)'/g, '"$1"');

                const parsed = JSON.parse(repaired);
                const formatted = JSON.stringify(parsed, null, 2);

                const rendered = renderColoredCode(formatted);
                codeEditor.innerHTML = rendered.code;
                document.getElementById('lineNumbers').innerHTML = rendered.numbers;
                document.getElementById('foldIcons').innerHTML = rendered.icons;

                foldStates = {};
                currentData = parsed;
                renderTree(parsed);

                inputStatus.innerHTML = '<span class="success">✓ JSON repaired and formatted!</span>';
                document.getElementById('outputStatus').innerHTML = '<span class="success">✓ Tree view updated</span>';
            } else {
                const formatted = formatXML(input);
                const lines = formatted.split('\n');

                let codeHtml = '';
                let numbersHtml = '';

                lines.forEach((line, idx) => {
                    const highlighted = highlightXMLLine(line);
                    codeHtml += `<div class="code-line">${highlighted}</div>`;
                    numbersHtml += `<div class="code-line">${idx + 1}</div>`;
                });

                codeEditor.innerHTML = codeHtml;
                document.getElementById('lineNumbers').innerHTML = numbersHtml;
                document.getElementById('foldIcons').innerHTML = '';
                foldHierarchy = {};

                inputStatus.innerHTML = '<span class="success">✓ XML repaired and formatted!</span>';
            }
        } catch (e) {
            inputStatus.innerHTML = '<span style="color: #ff6b6b">✗ Could not repair: ' + e.message + '</span>';
        }
    }

    function formatXML(xml) {
        let formatted = '';
        let indent = '';
        xml.split(/>\s*</).forEach(function(node) {
            if (node.match(/^\/\w/)) indent = indent.substring(2);
            formatted += indent + '<' + node + '>\n';
            if (node.match(/^<?\w[^>]*[^\/]$/)) indent += '  ';
        });
        return formatted.substring(1, formatted.length - 2);
    }

    function parseXMLToObject(xml) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(xml, 'text/xml');

        function xmlToJson(node) {
            if (node.nodeType === 3) return node.nodeValue.trim();
            let obj = {};
            if (node.attributes && node.attributes.length > 0) {
                for (let i = 0; i < node.attributes.length; i++) {
                    obj['@' + node.attributes[i].name] = node.attributes[i].value;
                }
            }
            if (node.hasChildNodes()) {
                for (let i = 0; i < node.childNodes.length; i++) {
                    const child = node.childNodes[i];
                    const name = child.nodeName;
                    if (child.nodeType === 3) {
                        const text = child.nodeValue.trim();
                        if (text) return text;
                    } else {
                        if (typeof obj[name] === 'undefined') {
                            obj[name] = xmlToJson(child);
                        } else {
                            if (!Array.isArray(obj[name])) obj[name] = [obj[name]];
                            obj[name].push(xmlToJson(child));
                        }
                    }
                }
            }
            return obj;
        }
        return { [doc.documentElement.nodeName]: xmlToJson(doc.documentElement) };
    }

    function renderTree(data) {
        const treeView = document.getElementById('treeView');
        treeView.innerHTML = '';

        function renderNode(obj, parent, key = 'root', level = 0, path = '') {
            const nodeId = path + '_' + key;

            if (Array.isArray(obj)) {
                const count = obj.length;
                const isExpanded = expandedStates[nodeId] !== false;

                const toggle = document.createElement('span');
                toggle.className = 'tree-expand';
                toggle.textContent = isExpanded ? '▼' : '▶';
                toggle.onclick = function() {
                    expandedStates[nodeId] = !isExpanded;
                    renderTree(currentData);
                };

                const line = document.createElement('div');
                line.style.marginLeft = (level * 20) + 'px';
                line.appendChild(toggle);

                const keySpan = document.createElement('span');
                keySpan.className = 'tree-key';
                keySpan.textContent = key;
                line.appendChild(keySpan);

                line.appendChild(document.createTextNode(' : ['));

                const countSpan = document.createElement('span');
                countSpan.className = 'tree-count';
                countSpan.textContent = count + ' items';
                line.appendChild(countSpan);

                line.appendChild(document.createTextNode(' ]'));
                parent.appendChild(line);

                if (isExpanded) {
                    obj.forEach((item, index) => {
                        renderNode(item, parent, index.toString(), level + 1, nodeId);
                    });
                }
            } else if (typeof obj === 'object' && obj !== null) {
                const keys = Object.keys(obj);
                const count = keys.length;
                const isExpanded = expandedStates[nodeId] !== false;

                const toggle = document.createElement('span');
                toggle.className = 'tree-expand';
                toggle.textContent = isExpanded ? '▼' : '▶';
                toggle.onclick = function() {
                    expandedStates[nodeId] = !isExpanded;
                    renderTree(currentData);
                };

                const line = document.createElement('div');
                line.style.marginLeft = (level * 20) + 'px';
                line.appendChild(toggle);

                const keySpan = document.createElement('span');
                keySpan.className = 'tree-key';
                keySpan.textContent = key;
                line.appendChild(keySpan);

                line.appendChild(document.createTextNode(' : {'));

                const countSpan = document.createElement('span');
                countSpan.className = 'tree-count';
                countSpan.textContent = count + ' props';
                line.appendChild(countSpan);

                line.appendChild(document.createTextNode(' }'));
                parent.appendChild(line);

                if (isExpanded) {
                    keys.forEach(k => {
                        renderNode(obj[k], parent, k, level + 1, nodeId);
                    });
                }
            } else {
                const line = document.createElement('div');
                line.style.marginLeft = (level * 20) + 'px';
                line.textContent = '  ';

                const keySpan = document.createElement('span');
                keySpan.className = 'tree-key';
                keySpan.textContent = key;
                line.appendChild(keySpan);

                line.appendChild(document.createTextNode(' : '));

                const valueSpan = document.createElement('span');
                if (typeof obj === 'string') {
                    valueSpan.className = 'tree-string';
                    valueSpan.textContent = '"' + obj + '"';
                } else if (typeof obj === 'number') {
                    valueSpan.className = 'tree-number';
                    valueSpan.textContent = obj;
                } else if (typeof obj === 'boolean') {
                    valueSpan.className = 'tree-boolean';
                    valueSpan.textContent = obj;
                } else if (obj === null) {
                    valueSpan.className = 'tree-null';
                    valueSpan.textContent = 'null';
                }
                line.appendChild(valueSpan);
                parent.appendChild(line);
            }
        }

        renderNode(data, treeView);
    }

    function clearAll() {
        codeEditor.textContent = '';
        document.getElementById('foldIcons').innerHTML = '';
        document.getElementById('treeView').innerHTML = '<div style="padding: 20px; color: #858585;">Tree view will appear here after formatting</div>';
        updateLineNumbers();
        currentData = null;
        expandedStates = {};
        foldStates = {};
        foldHierarchy = {};
        document.getElementById('inputStatus').textContent = 'Cleared';
        document.getElementById('outputStatus').textContent = 'Cleared';
    }

    function loadSample() {
        let type = document.getElementById('formatType').value;
        let sample;
        if(type === 'json') {
            sample = `[
  {
    "label": "Activity",
    "parameterName": "Activity.any_other_intervention_1",
    "type": "text",
    "parameterValue": "qdasdcasdc",
    "stepName": "Management Interventions",
    "required": true
  },
  {
    "label": "Activity",
    "parameterName": "Activity.Any_other_intervention_1",
    "type": "text",
    "parameterValue": "qdasdcasdc",
    "stepName": "Projected Benefits",
    "required": false
  }
]`;
        } else {
            sample = `<?xml version="1.0" encoding="UTF-8" ?>
<employees>
  <employee>
    <id>1</id>
    <firstName>Tom</firstName>
    <lastName>Cruise</lastName>
    <photo>https://jsonformatter.org/img/tom-cruise.jpg</photo>
  </employee>
  <employee>
    <id>2</id>
    <firstName>Maria</firstName>
    <lastName>Sharapova</lastName>
    <photo>https://jsonformatter.org/img/Maria-Sharapova.jpg</photo>
  </employee>
</employees>`;
        }
        codeEditor.textContent = sample;
        updateLineNumbers();
        document.getElementById('inputStatus').innerHTML = '<span class="success">✓ Sample loaded - Click Format</span>';
    }

    updateLineNumbers();
    document.getElementById('treeView').innerHTML = '<div style="padding: 20px; color: #858585;">Tree view will appear here after formatting</div>';

    // Auto-load XML sample on page load for testing
    setTimeout(() => {
        document.getElementById('formatType').value = 'xml';
        loadSample();
        setTimeout(() => {
            formatCode();
        }, 100);
    }, 500);
</script>
</body>
</html>